# Cookbook for building the project dataset

This document describes the dataset created using the *run_analysis* R script available on this GitHub repository.
This script is part of a project assignment done for the Getting and Cleaning Data course from Coursera.

## Original data set

The original data set was made available here: http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones

See the README.txt from the original dataset for a description of the features of the original data set. 

## Tidy dataset

The goal of the first 4 steps of the project is to combine the different elements of the original dataset into a single dataset.

1. Merging the training and the test sets to create one data set

This is done by looping over the different datasets and concatenating the 3 datasets:
* *activities*, read from the y_{test|train}.txt files
* *subjects*, read from the subject_{test|train}.txt files
* *measures*, read from the X_{test|train}.txt files

The concatenation of "test" and "train" datasets (activities, subjects and measures) is performed using *rbind*. As a result, we now have 3 data frames.

As we need to perform specific operations on *activities* and *measures* in the next steps, we choose not to build a single data frame yet and continue working on data frames seperately.

2. Extracting only the measurements on the mean and standard deviation for each measurement.

We want to select only the features corresponding to mean and standard deviation measures.
To do so, we work with the *measures* data frame and as a first step, we want to set the column labels based on the content of the file *features.txt* which lists all the features in the order in which they appear on the rows of *measures*.

Once column names are set, the column names of *measures* look like:

tBodyAcc-mean()-X
tBodyAcc-mean()-Y
tBodyAcc-mean()-Z
tBodyAcc-std()-X
tBodyAcc-std()-Y
tBodyAcc-std()-Z
tBodyAcc-mad()-X
tBodyAcc-arCoeff()-X,2
...
fBodyAcc-meanFreq()-X

Now we only want to keep the measures that are mean or standard deviation. To do so, we drop the data frame columns whose name does not contain "mean(" or "std" using *grepl*.
Note that we need to match the opening parenthesis as we don't want the "meanFreq" which would match if we'd only selected "mean".

At that point we still have 3 data frames (activities, subjects and measures). *measures* now only contains means and standard deviations and is labelled according to feature names from features.txt file. 

3. Uses descriptive activity names to name the activities in the data set

The *activities* data frame contains a list of identifiers corresponding to the type of activity identified for each record. The file *activity_labels.txt* associates labels to those identifiers. As such, we use *merge* to join *activities* and *activity_labels* based on their common id.

After the merge, we can drop the activity identifier which is no longer of any use as we now have the activity name.

Now that all 3 data sets are clean and their columns correctly labelled, we combine them using *cbind* to build the result data frame.

4. Appropriately labels the data set with descriptive variable names.

The column names for the variables are still in the format from the *features.txt* file, such as "tBodyAcc-mean()-X". We want to make it a little bit more descriptive. We use several *gsub* on the column names to reformat them, turning "tBodyAcc-mean()-X" into "Body.Acc.mean.X".

After this step, the dataset has the following columns:

 $ subject.id                  : int  2 2 2 2 2 2 2 2 2 2 ...
 $ activity.name               : Factor w/ 6 levels "LAYING","SITTING",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ Body.Acc.mean.X             : num  0.257 0.286 0.275 0.27 0.275 ...
 $ Body.Acc.mean.Y             : num  -0.0233 -0.0132 -0.0261 -0.0326 -0.0278 ...
 $ Body.Acc.mean.Z             : num  -0.0147 -0.1191 -0.1182 -0.1175 -0.1295 ...
 $ Body.Acc.std.X              : num  -0.938 -0.975 -0.994 -0.995 -0.994 ...
 $ Body.Acc.std.Y              : num  -0.92 -0.967 -0.97 -0.973 -0.967 ...
 $ Body.Acc.std.Z              : num  -0.668 -0.945 -0.963 -0.967 -0.978 ...
 $ Gravity.Acc.mean.X          : num  0.936 0.927 0.93 0.929 0.927 ...
 $ Gravity.Acc.mean.Y          : num  -0.283 -0.289 -0.288 -0.293 -0.303 ...
 $ Gravity.Acc.mean.Z          : num  0.115 0.153 0.146 0.143 0.138 ...
 $ Gravity.Acc.std.X           : num  -0.925 -0.989 -0.996 -0.993 -0.996 ...
 $ Gravity.Acc.std.Y           : num  -0.937 -0.984 -0.988 -0.97 -0.971 ...
 $ Gravity.Acc.std.Z           : num  -0.564 -0.965 -0.982 -0.992 -0.968 ...
 $ Body.Acc.Jerk.mean.X        : num  0.072 0.0702 0.0694 0.0749 0.0784 ...
 $ Body.Acc.Jerk.mean.Y        : num  0.04575 -0.01788 -0.00491 0.03227 0.02228 ...
 $ Body.Acc.Jerk.mean.Z        : num  -0.10604 -0.00172 -0.01367 0.01214 0.00275 ...
 $ Body.Acc.Jerk.std.X         : num  -0.907 -0.949 -0.991 -0.991 -0.992 ...
 $ Body.Acc.Jerk.std.Y         : num  -0.938 -0.973 -0.971 -0.973 -0.979 ...
 $ Body.Acc.Jerk.std.Z         : num  -0.936 -0.978 -0.973 -0.976 -0.987 ...
 $ Body.Gyro.mean.X            : num  0.11998 -0.00155 -0.04821 -0.05664 -0.05999 ...
 $ Body.Gyro.mean.Y            : num  -0.0918 -0.1873 -0.1663 -0.126 -0.0847 ...
 $ Body.Gyro.mean.Z            : num  0.1896 0.1807 0.1542 0.1183 0.0787 ...
 $ Body.Gyro.std.X             : num  -0.883 -0.926 -0.973 -0.968 -0.975 ...
 $ Body.Gyro.std.Y             : num  -0.816 -0.93 -0.979 -0.975 -0.978 ...
 $ Body.Gyro.std.Z             : num  -0.941 -0.968 -0.976 -0.963 -0.968 ...
 $ Body.Gyro.Jerk.mean.X       : num  -0.2049 -0.1387 -0.0978 -0.1022 -0.0918 ...
 $ Body.Gyro.Jerk.mean.Y       : num  -0.1745 -0.0258 -0.0342 -0.0447 -0.029 ...
 $ Body.Gyro.Jerk.mean.Z       : num  -0.0934 -0.0714 -0.06 -0.0534 -0.0612 ...
 $ Body.Gyro.Jerk.std.X        : num  -0.901 -0.962 -0.984 -0.984 -0.988 ...
 $ Body.Gyro.Jerk.std.Y        : num  -0.911 -0.956 -0.988 -0.99 -0.992 ...
 $ Body.Gyro.Jerk.std.Z        : num  -0.939 -0.981 -0.976 -0.981 -0.982 ...
 $ Body.Acc.Mag.mean           : num  -0.867 -0.969 -0.976 -0.974 -0.976 ...
 $ Body.Acc.Mag.std            : num  -0.705 -0.954 -0.979 -0.977 -0.977 ...
 $ Gravity.Acc.Mag.mean        : num  -0.867 -0.969 -0.976 -0.974 -0.976 ...
 $ Gravity.Acc.Mag.std         : num  -0.705 -0.954 -0.979 -0.977 -0.977 ...
 $ Body.Acc.Jerk.Mag.mean      : num  -0.93 -0.974 -0.982 -0.983 -0.987 ...
 $ Body.Acc.Jerk.Mag.std       : num  -0.896 -0.941 -0.971 -0.975 -0.989 ...
 $ Body.Gyro.Mag.mean          : num  -0.796 -0.898 -0.939 -0.947 -0.957 ...
 $ Body.Gyro.Mag.std           : num  -0.762 -0.911 -0.972 -0.97 -0.969 ...
 $ Body.Gyro.Jerk.Mag.mean     : num  -0.925 -0.973 -0.987 -0.989 -0.99 ...
 $ Body.Gyro.Jerk.Mag.std      : num  -0.894 -0.944 -0.984 -0.986 -0.99 ...
 $ Body.Acc.mean.X             : num  -0.919 -0.961 -0.992 -0.993 -0.992 ...
 $ Body.Acc.mean.Y             : num  -0.918 -0.964 -0.965 -0.968 -0.969 ...
 $ Body.Acc.mean.Z             : num  -0.789 -0.957 -0.967 -0.967 -0.98 ...
 $ Body.Acc.std.X              : num  -0.948 -0.984 -0.995 -0.996 -0.995 ...
 $ Body.Acc.std.Y              : num  -0.925 -0.97 -0.974 -0.977 -0.967 ...
 $ Body.Acc.std.Z              : num  -0.636 -0.942 -0.962 -0.969 -0.978 ...
 $ Body.Acc.Jerk.mean.X        : num  -0.9 -0.944 -0.991 -0.991 -0.991 ...
 $ Body.Acc.Jerk.mean.Y        : num  -0.937 -0.969 -0.973 -0.972 -0.98 ...
 $ Body.Acc.Jerk.mean.Z        : num  -0.924 -0.973 -0.972 -0.97 -0.983 ...
 $ Body.Acc.Jerk.std.X         : num  -0.924 -0.962 -0.992 -0.992 -0.994 ...
 $ Body.Acc.Jerk.std.Y         : num  -0.943 -0.98 -0.971 -0.975 -0.979 ...
 $ Body.Acc.Jerk.std.Z         : num  -0.948 -0.981 -0.972 -0.981 -0.989 ...
 $ Body.Gyro.mean.X            : num  -0.824 -0.923 -0.973 -0.972 -0.976 ...
 $ Body.Gyro.mean.Y            : num  -0.808 -0.926 -0.981 -0.981 -0.98 ...
 $ Body.Gyro.mean.Z            : num  -0.918 -0.968 -0.972 -0.967 -0.969 ...
 $ Body.Gyro.std.X             : num  -0.903 -0.927 -0.973 -0.967 -0.974 ...
 $ Body.Gyro.std.Y             : num  -0.823 -0.932 -0.977 -0.972 -0.977 ...
 $ Body.Gyro.std.Z             : num  -0.956 -0.97 -0.979 -0.965 -0.97 ...
 $ Body.Acc.Mag.mean           : num  -0.791 -0.954 -0.976 -0.973 -0.978 ...
 $ Body.Acc.Mag.std            : num  -0.711 -0.96 -0.984 -0.982 -0.979 ...
 $ Body.Body.Acc.Jerk.Mag.mean : num  -0.895 -0.945 -0.971 -0.972 -0.987 ...
 $ Body.Body.Acc.Jerk.Mag.std  : num  -0.896 -0.934 -0.97 -0.978 -0.99 ...
 $ Body.Body.Gyro.Mag.mean     : num  -0.771 -0.924 -0.975 -0.976 -0.977 ...
 $ Body.Body.Gyro.Mag.std      : num  -0.797 -0.917 -0.974 -0.971 -0.97 ...
 $ Body.Body.Gyro.Jerk.Mag.mean: num  -0.89 -0.952 -0.986 -0.986 -0.99 ...
 $ Body.Body.Gyro.Jerk.Mag.std : num  -0.907 -0.938 -0.983 -0.986 -0.991 ...

Where:
 * subject.id is the identifier of the subject of the experiment [1:30]
 * activity.name is the type of activity identified (WALKING, WALKING_UPSTAIRS, WALKING_DOWNSTAIRS, SITTING, STANDING, LAYING)
 * all other columns contain numerical measures from sensors normalized to [-1; 1]

## Statistics dataset

Next, we want to use the tidy dataset to build a compute some statistics on subject's activities. 

5. From the data set in step 4, creates a second, independent tidy data set with the average of each variable for each activity and each subject.

To answer this question, we create a pivot table so that we can use the data from the subject.id and activity.name columns as dimensions instead of measures.

To build the pivot table and compute the aggregation, we rely on the *melt* and *cast* functions from the *reshape* library that must be installed.

As we want to compute the average value of all variables for each combination of subject and activity, we use the combination of "subject.id" and "activity.name" as the unique identifier for the *melt* function and for the *cast* function.

The *cast* function is applied with the *mean* function to compute the average of each variable.

The statistics dataset has the same columns as the tidy dataset plus the attributes from the "cast data frame".

